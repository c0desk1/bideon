---
// src/pages/admin/index.astro
import { SITE } from '@/data/site.ts';
import AdminLayout from '@/layouts/AdminLayout.astro';
import { getCollection } from 'astro:content';
import AuthorCard from '@/components/admin/AuthorCard.astro';
import LatestPostWidget from '@/components/admin/LatestPostWidget.astro';
import SystemInfoWidget from '@/components/admin/SystemInfoWidget.astro';
import StatCard from '@/components/admin/stats/StatCard.astro';

const allPosts = (await getCollection('blog', ({data}) => data.draft !== true))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const totalViews = "12.5k";
const totalComments = 129;
---
<AdminLayout title="Dashboard">
  
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    
    <div class="lg:col-span-3 space-y-8">
      
      <section class="bg-zinc-800 rounded-lg p-6 border border-zinc-700">
        <h1 class="text-2xl font-bold text-white">Selamat Datang Kembali, {SITE.TITLE}!</h1>
        <p class="text-zinc-400 mt-1">Ini adalah ringkasan dari situs dan konten Anda.</p>
      </section>

      <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
        
        <div class="xl:col-span-2 bg-zinc-800 rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-semibold text-white mb-4">Aktivitas Postingan</h2>
          <ul class="space-y-4">
            {allPosts.length > 0 ? (
              allPosts.map((post) => (
                <li class="flex justify-between items-start bg-zinc-700/50 p-4 rounded-md">
                  <div>
                    <p class="font-bold text-base text-white pr-4" title={post.data.title}>{post.data.title}</p>
                    <p class="text-xs text-zinc-400 mt-1">
                      {new Date(post.data.pubDate).toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'})}
                    </p>
                  </div>
                  <a href={`/admin/edit/${post.slug}`} class="text-blue-400 hover:underline text-sm font-semibold flex-shrink-0 ml-4 pt-0.5">
                    Edit
                  </a>
                </li>
              ))
            ) : (
              <p class="text-zinc-400">Belum ada postingan.</p>
            )}
          </ul>
        </div>

        <aside class="space-y-6">
          <StatCard title="Total Postingan" value={allPosts.length.toString()} iconBgColor="bg-blue-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-blue-300"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM7 6V8H17V6H7ZM7 10V12H17V10H7ZM7 14V16H14V14H7Z"></path></svg>
          </StatCard>
          <StatCard title="Total Views" value={totalViews} iconBgColor="bg-green-500/20">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-green-300"><path d="M12 2C15.3137 2 18 4.68629 18 8C18 11.3137 15.3137 14 12 14C8.68629 14 6 11.3137 6 8C6 4.68629 8.68629 2 12 2ZM12 20C17.5228 20 22 15.5228 22 10H20C20 14.4183 16.4183 18 12 18C7.58172 18 4 14.4183 4 10H2C2 15.5228 6.47715 20 12 20Z"></path></svg>
          </StatCard>
          <StatCard title="Total Komentar" value={totalComments.toString()} iconBgColor="bg-yellow-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-yellow-300"><path d="M10 3H14C18.4183 3 22 6.58172 22 11C22 15.4183 18.4183 19 14 19H13V22.5L8.5 19H8C4.13401 19 1 15.866 1 12C1 8.13401 4.13401 5 8 5H10V3Z"></path></svg>
          </StatCard>
        </aside>

      </div>
    </div>

    <aside class="lg:col-span-1 space-y-6">
      <AuthorCard />
      <LatestPostWidget />
      <SystemInfoWidget />
    </aside>

  </div>
</AdminLayout>