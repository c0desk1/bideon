---
import BaseLayout from '../layouts/BaseLayout.astro';

const res = await fetch('/api/status');
const data = await res.json();
---

<BaseLayout title="Status Sistem">
  <h1 class="text-2xl font-bold mb-4">Status Sistem</h1>
  <p class="text-sm text-muted mb-6">Diperbarui: {new Date(data.lastUpdated).toLocaleString()}</p>

  <div class="grid gap-4">
    {data.services.map(service => (
      <div class="bg-[#111] border border-[rgba(255,255,255,0.1)] p-4 rounded-md">
        <h2 class="text-lg">{service.name}</h2>
        <p>Status: <span class={service.ok ? 'text-green-400' : 'text-red-400'}>
          {service.ok ? '✅ Online' : '❌ Down'}
        </span></p>
        <p>Latensi: {service.latency} ms</p>
      </div>
    ))}
  </div>

  <canvas id="latencyChart" class="mt-6"></canvas>

  <script type="module" is:raw>
    import Chart from "https://cdn.jsdelivr.net/npm/chart.js";

    const ctx = document.getElementById('latencyChart');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: {JSON.stringify(data.services.map(s => s.name))},
        datasets: [{
          label: 'Latensi (ms)',
          data: {JSON.stringify(data.services.map(s => s.latency))},
          backgroundColor: 'rgba(0, 112, 243, 0.8)',
          borderRadius: 4
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  </script>
</BaseLayout>