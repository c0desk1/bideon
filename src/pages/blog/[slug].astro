---
// src/pages/blog/[slug].astro
import Layout from '@/layouts/BlogLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';


export async function getStaticPaths() {
  const blogEntries: CollectionEntry<'blog'>[] = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'blog'>;
}

const { entry: propEntry } = Astro.props as Props;

let entry: CollectionEntry<'blog'> | undefined = propEntry;

if (!entry) {
  const allBlogEntries = await getCollection('blog');
  entry = allBlogEntries.find(e => e.slug === Astro.params.slug);
}

if (!entry) {
  return Astro.redirect('/404');
}

const { Content } = await entry.render();
const seoTitle = entry.data.ogTitle || entry.data.title;
const seoDescription = entry.data.ogDescription || entry.data.description;
const seoImage = typeof entry.data.ogImage === 'string' ? entry.data.ogImage : (typeof entry.data.heroImage === 'string' ? entry.data.heroImage : '/images/og-default.jpg');
const seoType = entry.data.ogType || 'article';

// Helper untuk format tanggal
function formatDate(date: Date) {
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
  return date.toLocaleDateString('id-ID', options);
}
---

<Layout
  title={seoTitle}
  description={seoDescription}
  ogImage={seoImage}
  ogType={seoType}
>
  <article class="container mx-auto px-4 py-16 md:py-24 max-w-3xl">
    <nav class="text-zinc-400 text-sm mb-8">
      <a href="/blog" class="hover:underline">Blog</a> / <span>{entry.data.title}</span>
    </nav>

    <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-6 leading-tight">
      {entry.data.title}
    </h1>

    <div class="flex flex-wrap items-center text-zinc-500 text-sm mb-8 gap-x-3 gap-y-2">
      {entry.data.author && (
        <div class="flex items-center">
          <span>Oleh <span class="font-semibold text-white">{entry.data.author}</span></span>
        </div>
      )}
      <span class="mx-0.5">•</span>
      <span>{formatDate(entry.data.pubDate)}</span>
      {entry.data.category && (
        <>
          <span class="mx-0.5">•</span>
          <a href={`/blog/category/${entry.data.category.toLowerCase().replace(/\s+/g, '-')}`} class="hover:underline text-blue-400 font-medium">
            {entry.data.category}
          </a>
        </>
      )}
    </div>
    {typeof entry.data.heroImage === 'string' && entry.data.heroImage && (
      <figure class="mb-10 rounded-lg overflow-hidden shadow-xl">
        <img
          src={entry.data.heroImage}
          alt={entry.data.description || entry.data.title}
          width="1200"
          height="600"
          class="w-full h-auto object-cover max-h-96"
          loading="lazy"
        />
        {entry.data.description && (
          <figcaption class="text-center text-zinc-500 text-sm mt-2">
            {entry.data.description}
          </figcaption>
        )}
      </figure>
    )}
    <div class="prose prose-invert max-w-none text-zinc-300">
      <Content />
    </div>
    {entry.data.tags && entry.data.tags.length > 0 && (
      <div class="mt-10 pt-6 border-t border-zinc-700">
        <span class="font-semibold text-white mr-2">Tags:</span>
        <div class="flex flex-wrap gap-2 mt-2">
          {entry.data.tags.map((tag: string) => (
            <a href={`/blog/tag/${tag.toLowerCase().replace(/\s+/g, '-')}`} class="inline-block bg-zinc-700 text-zinc-300 text-xs px-3 py-1 rounded-full hover:bg-zinc-600 transition-colors">
              {tag}
            </a>
          ))}
        </div>
      </div>
    )}
  </article>
</Layout>