---
export const prerender = true;

import { POSTS_PER_PAGE } from '../../../content/config.ts';

import Layout from '../../../layouts/BlogLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import type { PaginateFunction } from 'astro';



export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  const allPosts = await getCollection('blog');

  const sortedPosts = allPosts.sort(
    (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(sortedPosts, {
    pageSize: POSTS_PER_PAGE,
  });
}

const props = Astro.props;

if (!props.page || !props.page.data) {
  return new Response('Halaman tidak ditemukan', { status: 404 });
}

const { data: posts, currentPage, lastPage, url } = props.page;

function formatDate(date: Date) {
  return new Date(date).toLocaleDateString('id-ID', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}

const seoTitle = `Semua Postingan - Halaman ${currentPage}`;
const seoDescription = 'Jelajahi semua artikel dan insight terbaru dari Bima Akbar.';;
---
<Layout title={seoTitle} description={seoDescription}>
  <section class="container mx-auto px-4 py-16 md:py-24">
    <div class="text-center mb-12">
      <h1 class="text-4xl sm:text-5xl font-bold text-white">Semua Postingan</h1>
      <p class="mt-2 text-zinc-400 max-w-lg mx-auto">
        Jelajahi semua artikel dan insight terbaru dari saya.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {posts.map((post) => (
        <a href={`/blog/${post.slug}`} class="group block rounded-xl overflow-hidden bg-zinc-800 hover:bg-zinc-700 transition-colors shadow-md">
          {post.data.heroImage && (
            <img src={post.data.heroImage} alt={post.data.title ?? 'Thumbnail'} class="w-full h-48 object-cover" />
          )}
          <div class="p-5">
            <h2 class="text-lg font-semibold text-white group-hover:text-blue-400">
              {post.data.title}
            </h2>
            <p class="text-sm text-zinc-400">{post.data.description}</p>
            <p class="mt-2 text-xs text-zinc-500">{formatDate(post.data.pubDate)}</p>
            <div class="text-xs text-zinc-400 mt-1 flex flex-wrap gap-1 items-center">
              {post.data.author && <span>{post.data.author}</span>}
              {post.data.author && post.data.category && <span>•</span>}
              {post.data.category && (
                <span class="bg-blue-600 text-white px-2 py-0.5 rounded-full text-xs">{post.data.category}</span>
              )}
            </div>
          </div>
        </a>
      ))}
    </div>

    {lastPage > 1 && (
      <nav class="mt-12 flex justify-center gap-2">
        {url.prev && (
          <a href={url.prev} class="px-4 py-2 bg-zinc-700 text-white rounded hover:bg-zinc-600">← Sebelumnya</a>
        )}
        {Array.from({ length: lastPage }, (_, i) => (
          <a
            href={`/blog/page/${i + 1}`}
            class:list={[
              'px-3 py-2 rounded-lg text-white',
              i + 1 === currentPage ? 'bg-blue-600' : 'bg-zinc-800 hover:bg-zinc-700',
            ]}
          >
            {i + 1}
          </a>
        ))}
        {url.next && (
          <a href={url.next} class="px-4 py-2 bg-zinc-700 text-white rounded hover:bg-zinc-600">Selanjutnya →</a>
        )}
      </nav>
    )}
  </section>
</Layout>
