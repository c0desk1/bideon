---
// src/components/FeaturedBento.astro
import { Image } from 'astro:assets';
import { getCollection, type CollectionEntry } from 'astro:content';

const allPosts: CollectionEntry<'blog'>[] = await getCollection('blog', ({ data }) => {
  return data.isFeatured === true;
});

const sortedFeaturedPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const mainPost: CollectionEntry<'blog'> | undefined = sortedFeaturedPosts[0];
const otherPosts: CollectionEntry<'blog'>[] = sortedFeaturedPosts.slice(1, 3);

function formatDate(isoDate: string) {
  return new Date(isoDate).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
}
---

<section class="bg-zinc-900">
  <div class="container mx-auto px-4 py-16">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-white">Postingan Unggulan</h2>
    </div>
    {sortedFeaturedPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-3 md:grid-rows-2 gap-6">
        {mainPost && (
          <a href={`/blog/${mainPost.slug}`} class="block md:col-span-2 md:row-span-2 group relative overflow-hidden rounded-xl flex-col justify-end">
            {/* Perbaikan di sini: Pastikan src tidak undefined */}
            {mainPost.data.heroImage && (
              <img
                src={mainPost.data.heroImage}
                alt={mainPost.data.title}
                width={600}
                height={400}
                loading="lazy"
                class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />
            )}
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
            <div class="relative p-6 space-y-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                    {mainPost.data.category && (
                        <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-2 py-1 rounded-full">{mainPost.data.category}</span>
                    )}
                    {mainPost.data.tags && mainPost.data.tags.length > 0 && mainPost.data.tags.slice(0, 2).map((tag: string) => (
                        <span class="inline-block bg-zinc-700 text-zinc-200 text-xs font-semibold px-2 py-1 rounded-full">{tag}</span>
                    ))}
                </div>
                <h3 class="text-2xl font-bold text-white">{mainPost.data.title}</h3>
                <p class="text-zinc-300 mt-2 line-clamp-2">{mainPost.data.description}</p>
              </div>
              <div class="flex items-center gap-4 pt-4 border-t border-white/10">
                <div>
                  <p class="text-sm font-semibold text-white">{mainPost.data.author}</p>
                  <p class="text-xs text-zinc-400">{formatDate(mainPost.data.pubDate.toISOString())}</p>
                </div>
              </div>
            </div>
          </a>
        )}
        {otherPosts.map(post => (
          <a href={`/blog/${post.slug}`} class="group relative overflow-hidden rounded-xl flex flex-col justify-end">
             {/* Perbaikan di sini juga */}
             {post.data.heroImage && (
                <img
                    src={post.data.heroImage}
                    alt={post.data.title}
                    width={600}
                    height={400}
                    loading="lazy"
                    class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
             )}
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
            <div class="relative p-4">
              {post.data.category && (
                <span class="inline-block bg-blue-600/80 text-white text-xs font-semibold px-2 py-1 rounded-full mb-2">{post.data.category}</span>
              )}
              <h3 class="text-lg font-bold text-white line-clamp-2">{post.data.title}</h3>
            </div>
          </a>
        ))}

      </div>
    ) : (
      <div class="border-2 border-dashed border-gray-700 rounded-lg p-12 text-center text-gray-500">
        <p>Tidak ada postingan pilihan saat ini.</p>
      </div>
    )}
  </div>
</section>