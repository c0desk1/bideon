---
// src/components/RecentPosts.astro
import { Image } from 'astro:assets';
import { getCollection, type CollectionEntry } from 'astro:content';
import { POSTS_PER_PAGE } from '@/content/config';


const allPosts: CollectionEntry<'blog'>[] = await getCollection('blog', ({ data }) => {
  return data.pubDate;
});

const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const hasMultiplePages = totalPages > 0;
const blogFirstPageUrl = hasMultiplePages ? '/blog/page/1' : '#';

const posts: CollectionEntry<'blog'>[] = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);

function formatDate(dateString: string) {
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
  return new Date(dateString).toLocaleDateString('id-ID', options);
}
---

<section id="recent-posts" class="container mx-auto px-4 py-24">
  <div class="text-center mb-12">
    <h2 class="text-4xl font-bold text-white">Postingan Terbaru</h2>
    <p class="mt-2 text-zinc-400 max-w-lg mx-auto">
      Baca artikel dan insight terbaru dari saya.
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {posts.length > 0 ? (
      posts.map((post) => (
        <a href={`/blog/${post.slug}`} class="block bg-zinc-800 rounded-lg shadow-lg overflow-hidden transition-transform duration-200 hover:scale-[1.02] hover:shadow-2xl group">
          {post.data.heroImage && (
            <img
              src={post.data.heroImage}
              alt={post.data.description || post.data.title}
              width="600"
              height="400"
              loading="lazy"
              class="w-full h-48 object-cover group-hover:opacity-90 transition-opacity duration-200"
            />
          )}
          <div class="p-6">
            <h3 class="text-xl font-semibold text-white mb-2 group-hover:text-blue-400 transition-colors duration-200">
              {post.data.title}
            </h3>
            {post.data.description && (
              <p class="text-zinc-400 text-sm mb-3">
                {post.data.description}
              </p>
            )}

            <div class="text-zinc-500 text-xs flex flex-wrap items-center gap-x-2 gap-y-1 mb-3">
                {post.data.author && (
                    <span class="flex items-center">
                        <span>{post.data.author}</span>
                    </span>
                )}
                {post.data.author && post.data.category && <span class="mx-0.5">•</span>}
                {post.data.category && (
                    <span class="bg-blue-600 text-white px-2 py-0.5 rounded-full text-xs">
                        {post.data.category}
                    </span>
                )}
                {post.data.tags && post.data.tags.length > 0 && (
                    <>
                      {((post.data.author && (post.data.category || (post.data.tags && post.data.tags.length > 0))) ||
                         (!post.data.author && post.data.category && (post.data.tags && post.data.tags.length > 0))) &&
                        <span class="mx-0.5">•</span>
                      }

                      <div class="text-zinc-600 text-xs flex flex-wrap gap-1">
                          {post.data.tags.map((tag: string) => (
                              <span class="bg-zinc-700 text-zinc-400 px-2 py-0.5 rounded-md">
                                  {tag}
                              </span>
                          ))}
                      </div>
                    </>
                )}
            </div>

            <p class="text-zinc-500 text-xs">
              {formatDate(post.data.pubDate.toISOString())}
            </p>
          </div>
        </a>
      ))
    ) : (
      <p class="text-center text-zinc-400 col-span-full">Belum ada postingan terbaru.</p>
    )}
  </div>

  {hasMultiplePages && posts.length > 0 &&  (
    <div class="mt-12 text-center">
      <a href={blogFirstPageUrl} class="inline-block bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors text-lg">
        Lihat Semua
      </a>
    </div>
  )}
</section>
