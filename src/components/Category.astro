---
// src/components/category.astro
import { getCollection, type CollectionEntry } from 'astro:content';
import CategoryTabs from './CategoryTabs.tsx';

const MAX_POSTS = 3;

const allPosts = (await getCollection('blog'))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const latestPosts = allPosts.slice(0, MAX_POSTS);

const postsByCategory: Record<string, CollectionEntry<'blog'>[]> = {};

for (const post of allPosts) {
  const category = post.data.category;
  if (category) {
    if (!postsByCategory[category]) {
      postsByCategory[category] = [];
    }
    if (postsByCategory[category].length < MAX_POSTS) {
      postsByCategory[category].push(post);
    }
  }
}

const uniqueCategories = Object.keys(postsByCategory).sort((a, b) => a.localeCompare(b));
---

<section id="blog-categories" class="container mx-auto px-4 py-16">
  <div class="text-left mb-6">
    <p class="inline-block text-xs font-medium bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-transparent bg-clip-text uppercase tracking-wider">
      Kategori
    </p>
    <h2 class="text-3xl font-bold text-white leading-snug">Jelajahi Postingan Terbaru</h2>
    <span class="text-sm text-zinc-400 leading-relaxed max-w-md">
      Temukan artikel berdasarkan topik yang Anda minati.
    </p>
  </div>
  <CategoryTabs
    client:load
    latestPosts={latestPosts}
    postsByCategory={postsByCategory}
    categories={uniqueCategories}
  />
</section>